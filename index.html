<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å–µå®‡å®™ - çŒ«å’ªå±•ç¤ºå¡ç‰‡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            width: 100%;
        }

        /* Auth bar styling - è®¤è¯æ æ ·å¼ */
        .auth-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .auth-bar-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .auth-bar-logo {
            font-size: 1.2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .auth-bar-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .auth-user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #333;
            font-size: 0.9rem;
        }

        .auth-user-email {
            font-weight: 600;
            color: #667eea;
        }

        .auth-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .auth-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .auth-button.secondary {
            background: #6c757d;
        }

        .auth-button.secondary:hover {
            background: #5a6268;
        }

        .add-cat-button {
            background: #28a745;
        }

        .add-cat-button:hover {
            background: #218838;
        }

        /* Auth modal styling - è®¤è¯å¼¹çª—æ ·å¼ */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .auth-modal.active {
            display: flex;
        }

        .auth-modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }

        .auth-modal-subtitle {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 30px;
            text-align: center;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .auth-form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .auth-form-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #333;
        }

        .auth-form-input {
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .auth-form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .auth-form-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .auth-form-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .auth-form-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .auth-form-switch {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 0.9rem;
        }

        .auth-form-link {
            color: #667eea;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
        }

        .auth-form-link:hover {
            text-decoration: underline;
        }

        .auth-error {
            background: #fee;
            color: #c33;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            text-align: center;
        }

        .auth-success {
            background: #efe;
            color: #3c3;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            text-align: center;
        }

        .title {
            text-align: center;
            color: white;
            font-size: 2.5rem;
            margin-bottom: 40px;
            margin-top: 80px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            padding: 20px;
        }

        /* Cat card styling */
        .cat-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .cat-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        .cat-image-container {
            width: 100%;
            height: 250px;
            overflow: hidden;
            background: #f5f5f5;
            position: relative;
        }

        .cat-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .cat-card:hover .cat-image {
            transform: scale(1.1);
        }

        .cat-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.95);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* Photo upload button styling */
        .upload-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(102, 126, 234, 0.95);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 20;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            pointer-events: none;
        }

        .upload-button:hover {
            background: rgba(102, 126, 234, 1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .cat-image-container:hover .upload-button {
            opacity: 1;
            pointer-events: auto;
        }

        .cat-image-container:hover::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 5;
        }

        /* Hide file input */
        .file-input {
            display: none;
        }

        /* GIF generation button - ç”ŸæˆGIFæŒ‰é’® */
        .gif-button {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.8);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
            opacity: 0.6;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .gif-button:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.95);
            transform: scale(1.1);
        }

        .gif-button.generating {
            background: rgba(102, 126, 234, 0.9);
            color: white;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* Carousel controls - è½®æ’­å›¾æ§åˆ¶ */
        .carousel-nav {
            position: absolute;
            top: 50%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 10px;
            transform: translateY(-50%);
            z-index: 15;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .cat-image-container:hover .carousel-nav {
            opacity: 1;
            pointer-events: auto;
        }

        .carousel-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .carousel-btn:hover {
            background: white;
            transform: scale(1.1);
        }

        .carousel-indicator {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            z-index: 15;
        }

        /* Edit button - ç¼–è¾‘æŒ‰é’® */
        .edit-button {
            display: block;
            width: 100%;
            padding: 10px;
            margin-top: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .edit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        /* Edit mode styling - ç¼–è¾‘æ¨¡å¼æ ·å¼ */
        .cat-card.editing {
            border: 3px solid #667eea;
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.3);
        }

        .cat-card.editing .cat-card:hover {
            transform: none;
        }

        .edit-input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
            background: #f8f9ff;
        }

        .edit-input:focus {
            outline: none;
            border-color: #764ba2;
            background: white;
        }

        .edit-input.small {
            font-size: 1.1rem;
            font-weight: 400;
        }

        .edit-input.tiny {
            font-size: 0.9rem;
        }

        .stat-item input.edit-input {
            width: 100%;
            padding: 5px 8px;
            text-align: center;
        }

        .edit-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .edit-actions button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .save-button {
            background: #28a745;
            color: white;
        }

        .save-button:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .cancel-button {
            background: #6c757d;
            color: white;
        }

        .cancel-button:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .cat-info {
            padding: 20px;
        }

        .cat-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .cat-breed {
            color: #667eea;
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .cat-description {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .cat-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .stat-item {
            flex: 1;
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #999;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: #333;
        }

        .cat-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag {
            padding: 5px 12px;
            background: #e9ecef;
            color: #495057;
            border-radius: 15px;
            font-size: 0.8rem;
        }

        /* Loading animation */
        .loading {
            text-align: center;
            color: white;
            font-size: 1.2rem;
        }

        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .title {
                font-size: 2rem;
            }

            .cards-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Auth bar - è®¤è¯æ  -->
    <div class="auth-bar" id="authBar" style="display: none;">
        <div class="auth-bar-left">
            <div class="auth-bar-logo">ğŸ± å–µå®‡å®™</div>
        </div>
        <div class="auth-bar-right">
            <!-- Logged out state - æœªç™»å½•çŠ¶æ€ -->
            <div id="authLoggedOut">
                <button class="auth-button" id="loginButton">ç™»å½•</button>
                <button class="auth-button" id="signupButton">æ³¨å†Œ</button>
            </div>
            <!-- Logged in state - å·²ç™»å½•çŠ¶æ€ -->
            <div id="authLoggedIn" style="display: none;">
                <div class="auth-user-info">
                    <span>æ¬¢è¿ï¼Œ</span>
                    <span class="auth-user-email" id="userEmail"></span>
                </div>
                <button class="auth-button add-cat-button" id="addCatButton">â• æ·»åŠ çŒ«å’ª</button>
                <button class="auth-button secondary" id="logoutButton">ç™»å‡º</button>
            </div>
        </div>
    </div>

    <!-- Auth modal - è®¤è¯å¼¹çª— -->
    <div class="auth-modal" id="authModal">
        <div class="auth-modal-content">
            <h2 class="auth-modal-title" id="modalTitle">ç™»å½•</h2>
            <p class="auth-modal-subtitle" id="modalSubtitle">ç™»å½•ä»¥ç®¡ç†æ‚¨çš„çŒ«å’ª</p>
            <div id="authMessage"></div>
            <form class="auth-form" id="authForm">
                <div class="auth-form-group">
                    <label class="auth-form-label">é‚®ç®±</label>
                    <input type="email" class="auth-form-input" id="authEmail" required placeholder="your@email.com">
                </div>
                <div class="auth-form-group">
                    <label class="auth-form-label">å¯†ç </label>
                    <input type="password" class="auth-form-input" id="authPassword" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" minlength="6">
                </div>
                <button type="submit" class="auth-form-button" id="authSubmitButton">ç™»å½•</button>
            </form>
            <div class="auth-form-switch">
                <span id="authSwitchText">è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ</span>
                <a class="auth-form-link" id="authSwitchLink">æ³¨å†Œ</a>
            </div>
        </div>
    </div>

    <div class="container">
        <h1 class="title">ğŸ± å–µå®‡å®™ </h1>
        <div id="cardsContainer" class="cards-grid">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>åŠ è½½ä¸­...</p>
            </div>
        </div>
    </div>

    <!-- GIF generation library - using gifshot which doesn't require external workers -->
    <script src="https://cdn.jsdelivr.net/npm/gifshot@0.4.5/dist/gifshot.min.js"></script>

    <!-- Supabase client library - Supabase å®¢æˆ·ç«¯åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        // Supabase configuration - Supabase é…ç½®
        // TODO: è¯·åœ¨ Supabase Dashboard > Settings > API ä¸­è·å–æ­£ç¡®çš„ anon key
        // å‚è€ƒ supabase-config-guide.md æ–‡ä»¶è·å–è¯¦ç»†æ­¥éª¤
        const SUPABASE_URL = 'https://vswrhnmhumfxgfrwpfwc.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZzd3Jobm1odW1meGdmcndwZndjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI2NDU2NDMsImV4cCI6MjA3ODIyMTY0M30.LRkpH5Wp-w9BOwD-CUJ3Yz9G_5Us0fkjBgKN3zdcL2s'; // è¯·æ›¿æ¢ä¸ºå®é™…çš„ anon key

        // Initialize Supabase client - åˆå§‹åŒ– Supabase å®¢æˆ·ç«¯
        let supabase = null;
        let supabaseEnabled = false;

        try {
            if (SUPABASE_ANON_KEY !== 'YOUR_SUPABASE_ANON_KEY_HERE') {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                supabaseEnabled = true;
                console.log('âœ“ Supabase å®¢æˆ·ç«¯å·²åˆå§‹åŒ–');
            } else {
                console.warn('âš  Supabase æœªé…ç½®ï¼Œè¯·åœ¨ä»£ç ä¸­è®¾ç½® SUPABASE_ANON_KEY');
                console.warn('å‚è€ƒ supabase-config-guide.md è·å–é…ç½®æ–¹æ³•');
            }
        } catch (error) {
            console.error('Supabase åˆå§‹åŒ–å¤±è´¥:', error);
        }

        // Sample cat data - ç¤ºä¾‹çŒ«å’ªæ•°æ®
        const catsData = [
            {
                id: 1,
                name: "å°æ©˜",
                breed: "æ©˜çŒ«",
                age: "2å²",
                gender: "å…¬",
                description: "æ€§æ ¼æ¸©é¡ºï¼Œå–œæ¬¢æ™’å¤ªé˜³ï¼Œå¯¹å°é±¼å¹²æ²¡æœ‰æŠµæŠ—åŠ›ã€‚æ˜¯ä¸ªä¸æŠ˜ä¸æ‰£çš„åƒè´§ï¼Œçœ‹è§é£Ÿç‰©å°±ä¼šå–µå–µå«ã€‚",
                images: ["https://images.unsplash.com/photo-1574158622682-e40e69881006?w=500&h=400&fit=crop"],
                badge: "æœ€å—æ¬¢è¿",
                tags: ["æ¸©é¡º", "äº²äºº", "åƒè´§"]
            },
            {
                id: 2,
                name: "é›ªçƒ",
                breed: "è‹±å›½çŸ­æ¯›çŒ«",
                age: "1å²",
                gender: "æ¯",
                description: "ä¼˜é›…çš„å°å…¬ä¸»ï¼Œæ¯›è‰²é›ªç™½çº¯å‡€ï¼Œçœ¼ç›æ˜¯æ¼‚äº®çš„è“è‰²ã€‚å–œæ¬¢å®‰é™çš„ç¯å¢ƒï¼Œå¶å°”ä¼šé«˜å†·ã€‚",
                images: ["https://images.unsplash.com/photo-1513360371669-4adf3dd7dff8?w=500&h=400&fit=crop"],
                badge: "æ–°æˆå‘˜",
                tags: ["ä¼˜é›…", "å®‰é™", "é«˜å†·"]
            },
            {
                id: 3,
                name: "è™æ–‘",
                breed: "ç¾å›½çŸ­æ¯›çŒ«",
                age: "3å²",
                gender: "å…¬",
                description: "æ´»åŠ›åè¶³çš„è¿åŠ¨å¥å°†ï¼Œå–œæ¬¢çˆ¬é«˜ä¸Šä½ï¼Œå¯¹é€—çŒ«æ£’å’Œæ¿€å…‰ç¬”éå¸¸æ„Ÿå…´è¶£ã€‚",
                images: ["https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?w=500&h=400&fit=crop"],
                badge: "æ´»åŠ›ä¹‹æ˜Ÿ",
                tags: ["æ´»æ³¼", "å¥½åŠ¨", "çˆ±ç©"]
            },
            {
                id: 4,
                name: "å¸ƒä¸",
                breed: "å¸ƒå¶çŒ«",
                age: "1.5å²",
                gender: "æ¯",
                description: "æ‹¥æœ‰æ·±è“è‰²çš„çœ¼ç›å’ŒæŸ”è½¯çš„é•¿æ¯›ï¼Œæ€§æ ¼æ¸©æŸ”ä½“è´´ï¼Œæ˜¯å®Œç¾çš„é™ªä¼´å‹çŒ«å’ªã€‚",
                images: ["https://images.unsplash.com/photo-1529778873920-4da4926a72c2?w=500&h=400&fit=crop"],
                badge: "æ¸©æŸ”å¤©ä½¿",
                tags: ["æ¸©æŸ”", "ç²˜äºº", "é¢œå€¼é«˜"]
            },
            {
                id: 5,
                name: "é»‘ç‚­",
                breed: "é»‘çŒ«",
                age: "4å²",
                gender: "å…¬",
                description: "å…¨èº«ä¹Œé»‘å‘äº®ï¼Œçœ¼ç›åœ¨é»‘æš—ä¸­ä¼šå‘å‡ºç¥ç§˜çš„ç»¿å…‰ã€‚æ€§æ ¼ç‹¬ç«‹ï¼Œä½†å¯¹ä¸»äººéå¸¸å¿ è¯šã€‚",
                images: ["https://images.unsplash.com/photo-1494256997604-768d1f608cac?w=500&h=400&fit=crop"],
                badge: "ç¥ç§˜ä½¿è€…",
                tags: ["ç‹¬ç«‹", "å¿ è¯š", "ç¥ç§˜"]
            },
            {
                id: 6,
                name: "å¥¶èŒ¶",
                breed: "æš¹ç½—çŒ«",
                age: "2.5å²",
                gender: "æ¯",
                description: "æ‹¥æœ‰ç‹¬ç‰¹çš„é‡ç‚¹è‰²èŠ±çº¹å’Œè“å®çŸ³èˆ¬çš„çœ¼ç›ã€‚æ€§æ ¼æ´»æ³¼ï¼Œå–œæ¬¢ä¸äººäº¤æµï¼Œå«å£°ç‹¬ç‰¹ã€‚",
                images: ["https://images.unsplash.com/photo-1543852786-1cf6624b9987?w=500&h=400&fit=crop"],
                badge: "è¯ç—¨å°å§",
                tags: ["æ´»æ³¼", "å¥è°ˆ", "èªæ˜"]
            }
        ];

        /**
         * Load cats from database
         * ä»æ•°æ®åº“åŠ è½½çŒ«å’ªæ•°æ®
         * @returns {Promise<Array>} - Array of cat data
         */
        async function loadCatsFromDatabase() {
            // Check if Supabase is enabled - æ£€æŸ¥æ˜¯å¦å¯ç”¨äº† Supabase
            if (!supabaseEnabled || !supabase) {
                console.warn('Supabase æœªå¯ç”¨ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®');
                return null;
            }

            try {
                const { data, error } = await supabase
                    .from('cats')
                    .select('*')
                    .order('id', { ascending: true });

                if (error) {
                    console.error('ä»æ•°æ®åº“åŠ è½½å¤±è´¥:', error);
                    return null;
                }

                // Convert database format to app format - è½¬æ¢æ•°æ®åº“æ ¼å¼åˆ°åº”ç”¨æ ¼å¼
                return data.map(dbCat => ({
                    id: dbCat.id,
                    name: dbCat.name,
                    breed: dbCat.breed || 'æœªçŸ¥å“ç§',
                    age: dbCat.age ? `${dbCat.age}å²` : 'æœªçŸ¥',
                    gender: dbCat.sex === 1 ? 'å…¬' : dbCat.sex === 2 ? 'æ¯' : 'æœªçŸ¥',
                    description: dbCat.description || 'æš‚æ— æè¿°',
                    // Use images from database, ensure it's always an array - ä½¿ç”¨æ•°æ®åº“çš„å›¾ç‰‡ï¼Œç¡®ä¿å§‹ç»ˆæ˜¯æ•°ç»„
                    images: (dbCat.images && Array.isArray(dbCat.images) && dbCat.images.length > 0)
                        ? dbCat.images
                        : [], // ç©ºæ•°ç»„ï¼Œä¸æ·»åŠ é»˜è®¤å›¾ç‰‡
                    badge: 'æ•°æ®åº“',
                    tags: dbCat.tags ? dbCat.tags.split(',').map(t => t.trim()).filter(t => t) : []
                }));
            } catch (error) {
                console.error('åŠ è½½æ•°æ®æ—¶å‡ºé”™:', error);
                return null;
            }
        }

        /**
         * Initialize the cat cards display
         * åˆå§‹åŒ–çŒ«å’ªå¡ç‰‡å±•ç¤º
         */
        async function initCatCards() {
            const container = document.getElementById('cardsContainer');

            // Load cats from database - ä»æ•°æ®åº“åŠ è½½çŒ«å’ª
            const dbCats = await loadCatsFromDatabase();

            // If database load successful, use database data; otherwise use default data
            // å¦‚æœæ•°æ®åº“åŠ è½½æˆåŠŸ,ä½¿ç”¨æ•°æ®åº“æ•°æ®;å¦åˆ™ä½¿ç”¨é»˜è®¤æ•°æ®
            if (dbCats && dbCats.length > 0) {
                catsData.length = 0; // Clear default data
                catsData.push(...dbCats);
                console.log(`ä»æ•°æ®åº“åŠ è½½äº† ${dbCats.length} åªçŒ«å’ª`);
            } else {
                console.log('ä½¿ç”¨é»˜è®¤æ•°æ®');
            }

            // Simulate loading delay - æ¨¡æ‹ŸåŠ è½½å»¶è¿Ÿ
            setTimeout(() => {
                container.innerHTML = '';

                // Render each cat card - æ¸²æŸ“æ¯ä¸ªçŒ«å’ªå¡ç‰‡
                catsData.forEach(cat => {
                    const card = createCatCard(cat);
                    container.appendChild(card);
                });

                // æ³¨é‡Šæ‰ localStorage åŠ è½½ï¼Œç°åœ¨æ‰€æœ‰æ•°æ®éƒ½æ¥è‡ªæ•°æ®åº“
                // Load saved images after cards are rendered - å¡ç‰‡æ¸²æŸ“ååŠ è½½ä¿å­˜çš„å›¾ç‰‡
                // setTimeout(() => {
                //     loadSavedImages();
                // }, 100);
            }, 800);
        }

        /**
         * Create a single cat card element
         * åˆ›å»ºå•ä¸ªçŒ«å’ªå¡ç‰‡å…ƒç´ 
         * @param {Object} cat - Cat data object
         * @returns {HTMLElement} - Card element
         */
        function createCatCard(cat) {
            // Create card container - åˆ›å»ºå¡ç‰‡å®¹å™¨
            const card = document.createElement('div');
            card.className = 'cat-card';
            card.setAttribute('data-cat-id', cat.id);

            // Get image src, use placeholder if no images - è·å–å›¾ç‰‡æºï¼Œå¦‚æœæ²¡æœ‰å›¾ç‰‡åˆ™ä½¿ç”¨å ä½ç¬¦
            const imageSrc = (cat.images && cat.images.length > 0)
                ? cat.images[0]
                : 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="500" height="400"%3E%3Crect fill="%23f0f0f0" width="500" height="400"/%3E%3Ctext fill="%23999" font-family="sans-serif" font-size="24" dy="200" dx="150"%3Eç‚¹å‡»ä¸Šä¼ ç…§ç‰‡%3C/text%3E%3C/svg%3E';

            const imageCount = cat.images ? cat.images.length : 0;
            const indicatorText = imageCount > 0 ? `1/${imageCount}` : '0 å¼ ç…§ç‰‡';

            // Build card HTML - æ„å»ºå¡ç‰‡HTML
            card.innerHTML = `
                <div class="cat-image-container">
                    <img src="${imageSrc}" alt="${cat.name}" class="cat-image" data-cat-id="${cat.id}">
                    <div class="cat-badge">${cat.badge}</div>
                    <button class="upload-button" data-cat-id="${cat.id}">ğŸ“· é€‰æ‹©ç…§ç‰‡</button>
                    <input type="file" class="file-input" accept="image/*" multiple data-cat-id="${cat.id}">
                    <button class="gif-button" data-cat-id="${cat.id}" title="ç”Ÿæˆè½®æ’­GIF">ğŸ¬</button>
                    <div class="carousel-nav">
                        <button class="carousel-btn prev-btn">â€¹</button>
                        <button class="carousel-btn next-btn">â€º</button>
                    </div>
                    <div class="carousel-indicator">${indicatorText}</div>
                </div>
                <div class="cat-info">
                    <h2 class="cat-name">${cat.name}</h2>
                    <div class="cat-breed">${cat.breed}</div>
                    <p class="cat-description">${cat.description}</p>
                    <div class="cat-stats">
                        <div class="stat-item">
                            <div class="stat-label">å¹´é¾„</div>
                            <div class="stat-value">${cat.age}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">æ€§åˆ«</div>
                            <div class="stat-value">${cat.gender}</div>
                        </div>
                    </div>
                    <div class="cat-tags">
                        ${cat.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                    <button class="edit-button">âœï¸ ç¼–è¾‘ä¿¡æ¯</button>
                </div>
            `;

            // Setup photo upload functionality - è®¾ç½®ç…§ç‰‡ä¸Šä¼ åŠŸèƒ½
            setupPhotoUpload(card, cat.id);

            // Setup carousel functionality - è®¾ç½®è½®æ’­åŠŸèƒ½
            setupCarousel(card, cat.id);

            // Setup edit functionality - è®¾ç½®ç¼–è¾‘åŠŸèƒ½
            setupEditMode(card, cat);

            // Setup GIF generation functionality - è®¾ç½®GIFç”ŸæˆåŠŸèƒ½
            setupGifGeneration(card, cat.id);

            return card;
        }

        /**
         * Setup photo upload functionality for a cat card
         * ä¸ºçŒ«å’ªå¡ç‰‡è®¾ç½®ç…§ç‰‡ä¸Šä¼ åŠŸèƒ½
         * @param {HTMLElement} card - Card element
         * @param {number} catId - Cat ID
         */
        function setupPhotoUpload(card, catId) {
            const uploadButton = card.querySelector('.upload-button');
            const fileInput = card.querySelector('.file-input');

            // Click upload button to trigger file input - ç‚¹å‡»ä¸Šä¼ æŒ‰é’®è§¦å‘æ–‡ä»¶é€‰æ‹©
            uploadButton.addEventListener('click', (event) => {
                event.stopPropagation(); // Prevent card click event - é˜»æ­¢å¡ç‰‡ç‚¹å‡»äº‹ä»¶
                fileInput.click();
            });

            // Handle multiple file selection - å¤„ç†å¤šæ–‡ä»¶é€‰æ‹©
            fileInput.addEventListener('change', (event) => {
                const files = Array.from(event.target.files);

                // Validate files - éªŒè¯æ–‡ä»¶
                if (files.length === 0) {
                    return;
                }

                // Check all files are images - æ£€æŸ¥æ‰€æœ‰æ–‡ä»¶éƒ½æ˜¯å›¾ç‰‡
                const validFiles = files.filter(file => file.type.startsWith('image/'));

                if (validFiles.length === 0) {
                    alert('è¯·é€‰æ‹©æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶');
                    return;
                }

                // Process and add multiple images - å¤„ç†å¹¶æ·»åŠ å¤šå¼ å›¾ç‰‡
                processMultipleImages(validFiles, catId, card);
            });
        }

        /**
         * Upload image to Supabase Storage
         * ä¸Šä¼ å›¾ç‰‡åˆ° Supabase Storage
         * @param {File} file - Image file
         * @param {number} catId - Cat ID
         * @returns {Promise<string>} - Public URL of uploaded image
         */
        async function uploadImageToStorage(file, catId) {
            if (!supabaseEnabled || !supabase) {
                console.error('uploadImageToStorage: Supabase æœªå¯ç”¨');
                throw new Error('Supabase æœªå¯ç”¨');
            }

            // Generate unique filename - ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å
            const timestamp = Date.now();
            const fileExt = file.name.split('.').pop();
            const randomStr = Math.random().toString(36).substring(7);
            const fileName = `${timestamp}_${randomStr}.${fileExt}`;
            const filePath = `${catId}/${fileName}`;

            console.log(`uploadImageToStorage: æ–‡ä»¶è·¯å¾„ = ${filePath}`);
            console.log(`uploadImageToStorage: æ–‡ä»¶å¤§å° = ${file.size} bytes`);
            console.log(`uploadImageToStorage: æ–‡ä»¶ç±»å‹ = ${file.type}`);

            // Upload file - ä¸Šä¼ æ–‡ä»¶
            console.log('uploadImageToStorage: è°ƒç”¨ supabase.storage.upload()...');
            const { data, error } = await supabase.storage
                .from('cat-images')
                .upload(filePath, file, {
                    cacheControl: '3600',
                    upsert: false
                });

            if (error) {
                console.error('uploadImageToStorage: ä¸Šä¼ å¤±è´¥', error);
                console.error('uploadImageToStorage: é”™è¯¯è¯¦æƒ…:', JSON.stringify(error, null, 2));
                throw error;
            }

            console.log('uploadImageToStorage: ä¸Šä¼ æˆåŠŸ', data);

            // Get public URL - è·å–å…¬å¼€ URL
            const { data: urlData } = supabase.storage
                .from('cat-images')
                .getPublicUrl(filePath);

            const publicUrl = urlData.publicUrl;
            console.log(`uploadImageToStorage: å…¬å¼€ URL = ${publicUrl}`);

            return publicUrl;
        }

        /**
         * Update cat images in database
         * æ›´æ–°æ•°æ®åº“ä¸­çš„çŒ«å’ªå›¾ç‰‡
         * @param {number} catId - Cat ID
         * @param {string[]} imageUrls - Array of image URLs
         * @returns {Promise<boolean>} - Success status
         */
        async function updateCatImages(catId, imageUrls) {
            if (!supabaseEnabled || !supabase) {
                console.warn('Supabase æœªå¯ç”¨ï¼Œè·³è¿‡æ•°æ®åº“æ›´æ–°');
                return false;
            }

            try {
                const { error } = await supabase
                    .from('cats')
                    .update({
                        images: imageUrls,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', catId);

                if (error) {
                    console.error('æ›´æ–°å›¾ç‰‡å¤±è´¥:', error);
                    return false;
                }

                return true;
            } catch (error) {
                console.error('æ›´æ–°å›¾ç‰‡æ—¶å‡ºé”™:', error);
                return false;
            }
        }

        /**
         * Process multiple uploaded images
         * å¤„ç†å¤šå¼ ä¸Šä¼ çš„å›¾ç‰‡
         * @param {File[]} files - Array of image files
         * @param {number} catId - Cat ID
         * @param {HTMLElement} card - Card element
         */
        async function processMultipleImages(files, catId, card) {
            const uploadButton = card.querySelector('.upload-button');
            const originalText = uploadButton.textContent;

            try {
                // Show upload progress - æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
                uploadButton.textContent = 'ğŸ“¤ ä¸Šä¼ ä¸­...';
                uploadButton.disabled = true;

                let newImageUrls;

                // Try to upload to Supabase Storage first - ä¼˜å…ˆä¸Šä¼ åˆ° Supabase Storage
                if (supabaseEnabled && supabase) {
                    console.log(`å¼€å§‹ä¸Šä¼  ${files.length} å¼ å›¾ç‰‡åˆ° Supabase Storage...`);
                    console.log(`çŒ«å’ª ID: ${catId}`);
                    console.log(`Supabase çŠ¶æ€:`, { enabled: supabaseEnabled, client: !!supabase });

                    try {
                        const uploadPromises = files.map((file, index) => {
                            console.log(`å‡†å¤‡ä¸Šä¼ æ–‡ä»¶ ${index + 1}/${files.length}: ${file.name} (${(file.size / 1024).toFixed(2)} KB)`);
                            return uploadImageToStorage(file, catId);
                        });
                        newImageUrls = await Promise.all(uploadPromises);
                        console.log(`âœ“ æˆåŠŸä¸Šä¼  ${newImageUrls.length} å¼ å›¾ç‰‡åˆ° Supabase Storage`);
                        console.log('ä¸Šä¼ çš„ URLs:', newImageUrls);
                    } catch (uploadError) {
                        console.error('Supabase Storage ä¸Šä¼ å¤±è´¥ï¼Œè¯¦ç»†é”™è¯¯:', uploadError);
                        console.error('é”™è¯¯å †æ ˆ:', uploadError.stack);
                        throw uploadError;
                    }
                } else {
                    // Fallback to localStorage - é™çº§åˆ° localStorage
                    console.warn('Supabase æœªå¯ç”¨ï¼Œä½¿ç”¨ localStorage');
                    console.warn(`Supabase çŠ¶æ€: enabled=${supabaseEnabled}, client=${!!supabase}`);
                    const imagePromises = files.map(file => {
                        return new Promise((resolve, reject) => {
                            const reader = new FileReader();
                            reader.onload = (e) => resolve(e.target.result);
                            reader.onerror = reject;
                            reader.readAsDataURL(file);
                        });
                    });
                    newImageUrls = await Promise.all(imagePromises);
                    console.log('ä½¿ç”¨ localStorageï¼Œå·²è½¬æ¢ä¸º Base64');
                }

                // Find cat data and update images - æŸ¥æ‰¾çŒ«å’ªæ•°æ®å¹¶æ›´æ–°å›¾ç‰‡
                const cat = catsData.find(c => c.id === catId);
                if (!cat) {
                    throw new Error('æœªæ‰¾åˆ°çŒ«å’ªæ•°æ®');
                }

                // Check if current images are default (from unsplash) - æ£€æŸ¥å½“å‰å›¾ç‰‡æ˜¯å¦æ˜¯é»˜è®¤å›¾ç‰‡
                const hasDefaultImages = cat.images.length === 1 &&
                                        cat.images[0].includes('unsplash.com');

                // If has default images, replace them; otherwise append - å¦‚æœæœ‰é»˜è®¤å›¾ç‰‡åˆ™æ›¿æ¢ï¼Œå¦åˆ™è¿½åŠ 
                if (hasDefaultImages) {
                    cat.images = newImageUrls;
                } else {
                    cat.images = [...cat.images, ...newImageUrls];
                }

                // Save to database if Supabase is enabled - å¦‚æœå¯ç”¨äº† Supabase åˆ™ä¿å­˜åˆ°æ•°æ®åº“
                if (supabaseEnabled && supabase) {
                    const dbSuccess = await updateCatImages(catId, cat.images);
                    if (dbSuccess) {
                        console.log('âœ“ å›¾ç‰‡ URLs å·²ä¿å­˜åˆ°æ•°æ®åº“');
                    } else {
                        console.warn('âš  æ•°æ®åº“æ›´æ–°å¤±è´¥ï¼Œä»…ä¿å­˜åˆ°æœ¬åœ°');
                    }
                }

                // æ³¨é‡Šæ‰ localStorage å¤‡ä»½ï¼Œç°åœ¨æ‰€æœ‰æ•°æ®éƒ½æ¥è‡ªæ•°æ®åº“
                // Also save to localStorage as backup - åŒæ—¶ä¿å­˜åˆ° localStorage ä½œä¸ºå¤‡ä»½
                // try {
                //     localStorage.setItem(`cat-images-${catId}`, JSON.stringify(cat.images));
                // } catch (e) {
                //     console.warn('æ— æ³•ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨:', e);
                // }

                // Update display to show the first new image - æ›´æ–°æ˜¾ç¤ºï¼Œæ˜¾ç¤ºç¬¬ä¸€å¼ æ–°å›¾ç‰‡
                const imgElement = card.querySelector('.cat-image');
                let currentIndex;

                if (hasDefaultImages) {
                    // If replaced default images, show first image - å¦‚æœæ›¿æ¢äº†é»˜è®¤å›¾ç‰‡ï¼Œæ˜¾ç¤ºç¬¬ä¸€å¼ 
                    currentIndex = 0;
                } else {
                    // If appended, show first new image - å¦‚æœæ˜¯è¿½åŠ ï¼Œæ˜¾ç¤ºç¬¬ä¸€å¼ æ–°å›¾ç‰‡
                    currentIndex = cat.images.length - newImageUrls.length;
                }

                imgElement.src = cat.images[currentIndex];

                // Update indicator - æ›´æ–°æŒ‡ç¤ºå™¨
                const indicator = card.querySelector('.carousel-indicator');
                indicator.textContent = `${currentIndex + 1}/${cat.images.length}`;

                // Update carousel index - æ›´æ–°è½®æ’­ç´¢å¼•
                card.carouselIndex = currentIndex;

                // Stop existing autoplay if any - åœæ­¢ç°æœ‰çš„è‡ªåŠ¨æ’­æ”¾
                if (card.carouselInterval) {
                    clearInterval(card.carouselInterval);
                }

                // Restart autoplay if more than 1 image - å¦‚æœæœ‰å¤šå¼ å›¾ç‰‡åˆ™é‡å¯è‡ªåŠ¨æ’­æ”¾
                if (cat.images.length > 1) {
                    card.carouselInterval = setInterval(() => {
                        const images = cat.images;
                        if (images.length > 0) {
                            card.carouselIndex = (card.carouselIndex + 1) % images.length;
                            imgElement.src = images[card.carouselIndex];
                            indicator.textContent = `${card.carouselIndex + 1}/${images.length}`;
                        }
                    }, 3000);
                }

                // Reset upload button - æ¢å¤ä¸Šä¼ æŒ‰é’®
                uploadButton.textContent = originalText;
                uploadButton.disabled = false;

            } catch (error) {
                console.error('å›¾ç‰‡ä¸Šä¼ å¤±è´¥:', error);
                alert('å›¾ç‰‡ä¸Šä¼ å¤±è´¥: ' + error.message);

                // Reset upload button - æ¢å¤ä¸Šä¼ æŒ‰é’®
                uploadButton.textContent = originalText;
                uploadButton.disabled = false;
            }
        }

        /**
         * Setup carousel functionality for a cat card
         * ä¸ºçŒ«å’ªå¡ç‰‡è®¾ç½®è½®æ’­åŠŸèƒ½
         * @param {HTMLElement} card - Card element
         * @param {number} catId - Cat ID
         */
        function setupCarousel(card, catId) {
            const imgElement = card.querySelector('.cat-image');
            const indicator = card.querySelector('.carousel-indicator');
            const prevBtn = card.querySelector('.prev-btn');
            const nextBtn = card.querySelector('.next-btn');

            // Initialize carousel index - åˆå§‹åŒ–è½®æ’­ç´¢å¼•
            card.carouselIndex = 0;
            card.carouselInterval = null;

            // Get current cat images - è·å–å½“å‰çŒ«å’ªçš„å›¾ç‰‡
            function getCatImages() {
                const cat = catsData.find(c => c.id === catId);
                return cat ? cat.images : [];
            }

            // Show image at specific index - æ˜¾ç¤ºæŒ‡å®šç´¢å¼•çš„å›¾ç‰‡
            function showImage(index) {
                const images = getCatImages();
                if (images.length === 0) return;

                card.carouselIndex = (index + images.length) % images.length;
                imgElement.src = images[card.carouselIndex];
                indicator.textContent = `${card.carouselIndex + 1}/${images.length}`;
            }

            // Navigate to previous image - åˆ‡æ¢åˆ°ä¸Šä¸€å¼ 
            function prevImage(event) {
                event.stopPropagation();
                stopAutoPlay();
                showImage(card.carouselIndex - 1);
                startAutoPlay();
            }

            // Navigate to next image - åˆ‡æ¢åˆ°ä¸‹ä¸€å¼ 
            function nextImage(event) {
                event.stopPropagation();
                stopAutoPlay();
                showImage(card.carouselIndex + 1);
                startAutoPlay();
            }

            // Start auto play - å¼€å§‹è‡ªåŠ¨æ’­æ”¾
            function startAutoPlay() {
                const images = getCatImages();
                if (images.length <= 1) return;

                stopAutoPlay();
                card.carouselInterval = setInterval(() => {
                    showImage(card.carouselIndex + 1);
                }, 3000);
            }

            // Stop auto play - åœæ­¢è‡ªåŠ¨æ’­æ”¾
            function stopAutoPlay() {
                if (card.carouselInterval) {
                    clearInterval(card.carouselInterval);
                    card.carouselInterval = null;
                }
            }

            // Add event listeners - æ·»åŠ äº‹ä»¶ç›‘å¬
            prevBtn.addEventListener('click', prevImage);
            nextBtn.addEventListener('click', nextImage);

            // Start auto play when card is created - å¡ç‰‡åˆ›å»ºæ—¶å¼€å§‹è‡ªåŠ¨æ’­æ”¾
            startAutoPlay();

            // Pause on hover - æ‚¬åœæ—¶æš‚åœ
            card.addEventListener('mouseenter', stopAutoPlay);
            card.addEventListener('mouseleave', startAutoPlay);
        }

        /**
         * Setup edit mode functionality for a cat card
         * ä¸ºçŒ«å’ªå¡ç‰‡è®¾ç½®ç¼–è¾‘æ¨¡å¼åŠŸèƒ½
         * @param {HTMLElement} card - Card element
         * @param {Object} cat - Cat data object
         */
        function setupEditMode(card, cat) {
            const editButton = card.querySelector('.edit-button');
            const catInfo = card.querySelector('.cat-info');

            // Store original data - å­˜å‚¨åŸå§‹æ•°æ®
            let originalData = { ...cat };

            editButton.addEventListener('click', (event) => {
                event.stopPropagation();

                // Check if already editing - æ£€æŸ¥æ˜¯å¦å·²ç»åœ¨ç¼–è¾‘
                if (card.classList.contains('editing')) {
                    return;
                }

                // Enter edit mode - è¿›å…¥ç¼–è¾‘æ¨¡ï¿½ï¿½
                card.classList.add('editing');

                // Replace display elements with inputs - ç”¨è¾“å…¥æ¡†æ›¿æ¢æ˜¾ç¤ºå…ƒç´ 
                const nameElement = catInfo.querySelector('.cat-name');
                const breedElement = catInfo.querySelector('.cat-breed');
                const descElement = catInfo.querySelector('.cat-description');
                const ageElement = catInfo.querySelector('.stat-value:nth-child(1)');
                const tagsContainer = catInfo.querySelector('.cat-tags');

                catInfo.innerHTML = `
                    <input type="text" class="edit-input" value="${cat.name}" data-field="name" placeholder="çŒ«å’ªåå­—">
                    <input type="text" class="edit-input small" value="${cat.breed}" data-field="breed" placeholder="å“ç§">
                    <input type="text" class="edit-input tiny" value="${cat.description}" data-field="description" placeholder="æè¿°">
                    <div class="cat-stats">
                        <div class="stat-item">
                            <div class="stat-label">å¹´é¾„</div>
                            <input type="text" class="edit-input small stat-value" value="${cat.age}" data-field="age" placeholder="å¹´é¾„">
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">æ€§åˆ«</div>
                            <div class="stat-value">${cat.gender}</div>
                        </div>
                    </div>
                    <input type="text" class="edit-input tiny" value="${cat.tags.join(', ')}" data-field="tags" placeholder="æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰">
                    <div class="edit-actions">
                        <button class="save-button">ğŸ’¾ ä¿å­˜</button>
                        <button class="cancel-button">âŒ å–æ¶ˆ</button>
                    </div>
                `;

                // Setup save and cancel buttons - è®¾ç½®ä¿å­˜å’Œå–æ¶ˆæŒ‰é’®
                const saveBtn = catInfo.querySelector('.save-button');
                const cancelBtn = catInfo.querySelector('.cancel-button');

                saveBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    saveEdit(card, cat, catInfo);
                });

                cancelBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    cancelEdit(card, cat, catInfo, originalData);
                });
            });
        }

        /**
         * Save cat data to Supabase database
         * å°†çŒ«å’ªæ•°æ®ä¿å­˜åˆ° Supabase æ•°æ®åº“
         * @param {Object} cat - Cat data object
         * @returns {Promise<boolean>} - Success status
         */
        async function saveCatToDatabase(cat) {
            // Check if Supabase is enabled - æ£€æŸ¥æ˜¯å¦å¯ç”¨äº† Supabase
            if (!supabaseEnabled || !supabase) {
                console.warn('Supabase æœªå¯ç”¨ï¼Œè·³è¿‡æ•°æ®åº“ä¿å­˜');
                return false;
            }

            try {
                // Map gender to database format (å…¬=1, æ¯=2)
                const sexValue = cat.gender === 'å…¬' ? 1 : cat.gender === 'æ¯' ? 2 : null;

                // Parse age number from string like "2å²"
                const ageValue = parseInt(cat.age) || null;

                // Prepare data for database - å‡†å¤‡æ•°æ®åº“æ•°æ®
                const catData = {
                    name: cat.name,
                    breed: cat.breed,
                    age: ageValue,
                    sex: sexValue,
                    description: cat.description,
                    tags: cat.tags.join(','),
                    updated_at: new Date().toISOString()
                };

                // Check if cat exists in database - æ£€æŸ¥çŒ«å’ªæ˜¯å¦å­˜åœ¨äºæ•°æ®åº“
                const { data: existingCat, error: fetchError } = await supabase
                    .from('cats')
                    .select('id')
                    .eq('id', cat.id)
                    .single();

                let result;
                if (existingCat) {
                    // Update existing cat - æ›´æ–°ç°æœ‰çŒ«å’ª
                    result = await supabase
                        .from('cats')
                        .update(catData)
                        .eq('id', cat.id);
                } else {
                    // Insert new cat - æ’å…¥æ–°çŒ«å’ª
                    catData.id = cat.id;
                    result = await supabase
                        .from('cats')
                        .insert(catData);
                }

                if (result.error) {
                    console.error('æ•°æ®åº“ä¿å­˜å¤±è´¥:', result.error);
                    return false;
                }

                console.log('æˆåŠŸä¿å­˜åˆ°æ•°æ®åº“:', cat.name);
                return true;
            } catch (error) {
                console.error('ä¿å­˜åˆ°æ•°æ®åº“æ—¶å‡ºé”™:', error);
                return false;
            }
        }

        /**
         * Save edited information
         * ä¿å­˜ç¼–è¾‘çš„ä¿¡æ¯
         * @param {HTMLElement} card - Card element
         * @param {Object} cat - Cat data object
         * @param {HTMLElement} catInfo - Cat info element
         */
        async function saveEdit(card, cat, catInfo) {
            // Get new values from inputs - ä»è¾“å…¥æ¡†è·å–æ–°å€¼
            const nameInput = catInfo.querySelector('[data-field="name"]');
            const breedInput = catInfo.querySelector('[data-field="breed"]');
            const descInput = catInfo.querySelector('[data-field="description"]');
            const ageInput = catInfo.querySelector('[data-field="age"]');
            const tagsInput = catInfo.querySelector('[data-field="tags"]');

            // Update cat data - æ›´æ–°çŒ«å’ªæ•°æ®
            cat.name = nameInput.value.trim() || cat.name;
            cat.breed = breedInput.value.trim() || cat.breed;
            cat.description = descInput.value.trim() || cat.description;
            cat.age = ageInput.value.trim() || cat.age;
            cat.tags = tagsInput.value.split(',').map(t => t.trim()).filter(t => t);

            // Save to database - ä¿å­˜åˆ°æ•°æ®åº“
            const dbSuccess = await saveCatToDatabase(cat);

            // æ³¨é‡Šæ‰ localStorage å¤‡ä»½ï¼Œç°åœ¨æ‰€æœ‰æ•°æ®éƒ½æ¥è‡ªæ•°æ®åº“
            // Save to localStorage as backup - ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ä½œä¸ºå¤‡ä»½
            // try {
            //     localStorage.setItem(`cat-data-${cat.id}`, JSON.stringify(cat));
            // } catch (e) {
            //     console.warn('æ— æ³•ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨:', e);
            // }

            // Show success message - æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            if (dbSuccess) {
                console.log('âœ“ æ•°æ®å·²ä¿å­˜åˆ°æ•°æ®åº“');
            } else {
                console.warn('âš  æ•°æ®åº“ä¿å­˜å¤±è´¥,ä»…ä¿å­˜åˆ°æœ¬åœ°');
            }

            // Exit edit mode and restore display - é€€å‡ºç¼–è¾‘æ¨¡å¼å¹¶æ¢å¤æ˜¾ç¤º
            restoreDisplayMode(card, cat, catInfo);
        }

        /**
         * Cancel editing and restore original data
         * å–æ¶ˆç¼–è¾‘å¹¶æ¢å¤åŸå§‹æ•°æ®
         * @param {HTMLElement} card - Card element
         * @param {Object} cat - Cat data object
         * @param {HTMLElement} catInfo - Cat info element
         * @param {Object} originalData - Original cat data
         */
        function cancelEdit(card, cat, catInfo, originalData) {
            // Restore original data - æ¢å¤åŸå§‹æ•°æ®
            Object.assign(cat, originalData);

            // Exit edit mode and restore display - é€€å‡ºç¼–è¾‘æ¨¡å¼å¹¶æ¢å¤æ˜¾ç¤º
            restoreDisplayMode(card, cat, catInfo);
        }

        /**
         * Restore display mode from edit mode
         * ä»ç¼–è¾‘æ¨¡å¼æ¢å¤æ˜¾ç¤ºæ¨¡å¼
         * @param {HTMLElement} card - Card element
         * @param {Object} cat - Cat data object
         * @param {HTMLElement} catInfo - Cat info element
         */
        function restoreDisplayMode(card, cat, catInfo) {
            // Remove editing class - ç§»é™¤ç¼–è¾‘ç±»
            card.classList.remove('editing');

            // Restore display HTML - æ¢å¤æ˜¾ç¤ºHTML
            catInfo.innerHTML = `
                <h2 class="cat-name">${cat.name}</h2>
                <div class="cat-breed">${cat.breed}</div>
                <p class="cat-description">${cat.description}</p>
                <div class="cat-stats">
                    <div class="stat-item">
                        <div class="stat-label">å¹´é¾„</div>
                        <div class="stat-value">${cat.age}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">æ€§åˆ«</div>
                        <div class="stat-value">${cat.gender}</div>
                    </div>
                </div>
                <div class="cat-tags">
                    ${cat.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                </div>
                <button class="edit-button">âœï¸ ç¼–è¾‘ä¿¡æ¯</button>
            `;

            // Re-setup edit button - é‡æ–°è®¾ç½®ç¼–è¾‘æŒ‰é’®
            const editButton = catInfo.querySelector('.edit-button');
            editButton.addEventListener('click', (event) => {
                event.stopPropagation();
                setupEditMode(card, cat);
                editButton.click();
            });
        }

        /**
         * Load saved images and data from localStorage
         * ä»æœ¬åœ°å­˜å‚¨åŠ è½½ä¿å­˜çš„å›¾ç‰‡å’Œæ•°æ®
         */
        function loadSavedImages() {
            catsData.forEach(cat => {
                // Load saved cat data first - å…ˆåŠ è½½ä¿å­˜çš„çŒ«å’ªæ•°æ®
                const savedData = localStorage.getItem(`cat-data-${cat.id}`);
                if (savedData) {
                    try {
                        const data = JSON.parse(savedData);
                        // Only update non-image fields - åªæ›´æ–°éå›¾ç‰‡å­—æ®µ
                        if (data.name) cat.name = data.name;
                        if (data.breed) cat.breed = data.breed;
                        if (data.description) cat.description = data.description;
                        if (data.age) cat.age = data.age;
                        if (data.tags) cat.tags = data.tags;
                    } catch (e) {
                        console.warn('æ— æ³•è§£æä¿å­˜çš„æ•°æ®:', e);
                    }
                }

                // Load multiple images - åŠ è½½å¤šå¼ å›¾ç‰‡ï¼ˆåœ¨æ•°æ®ä¹‹ååŠ è½½ï¼Œé¿å…è¢«è¦†ç›–ï¼‰
                const savedImages = localStorage.getItem(`cat-images-${cat.id}`);
                if (savedImages) {
                    try {
                        cat.images = JSON.parse(savedImages);
                    } catch (e) {
                        console.warn('æ— æ³•è§£æä¿å­˜çš„å›¾ç‰‡æ•°æ®:', e);
                    }
                }

                // Update display - æ›´æ–°æ˜¾ç¤º
                const card = document.querySelector(`.cat-card[data-cat-id="${cat.id}"]`);
                if (card) {
                    // Update image - æ›´æ–°å›¾ç‰‡
                    const imgElement = card.querySelector('.cat-image');
                    if (imgElement && cat.images[0]) {
                        imgElement.src = cat.images[0];
                    }

                    // Update indicator - æ›´æ–°æŒ‡ç¤ºå™¨
                    const indicator = card.querySelector('.carousel-indicator');
                    if (indicator) {
                        indicator.textContent = `1/${cat.images.length}`;
                    }

                    // Update cat info display - æ›´æ–°çŒ«å’ªä¿¡æ¯æ˜¾ç¤º
                    const catInfo = card.querySelector('.cat-info');
                    if (catInfo) {
                        const nameElement = catInfo.querySelector('.cat-name');
                        const breedElement = catInfo.querySelector('.cat-breed');
                        const descElement = catInfo.querySelector('.cat-description');
                        const ageElement = catInfo.querySelector('.stat-value');
                        const tagsContainer = catInfo.querySelector('.cat-tags');

                        if (nameElement) nameElement.textContent = cat.name;
                        if (breedElement) breedElement.textContent = cat.breed;
                        if (descElement) descElement.textContent = cat.description;
                        if (ageElement) ageElement.textContent = cat.age;
                        if (tagsContainer) {
                            tagsContainer.innerHTML = cat.tags.map(tag => `<span class="tag">${tag}</span>`).join('');
                        }
                    }
                }
            });
        }


        /**
         * Setup GIF generation functionality for a cat card
         * ä¸ºçŒ«å’ªå¡ç‰‡è®¾ç½®GIFç”ŸæˆåŠŸèƒ½
         * @param {HTMLElement} card - Card element
         * @param {number} catId - Cat ID
         */
        function setupGifGeneration(card, catId) {
            const gifButton = card.querySelector('.gif-button');

            gifButton.addEventListener('click', async (event) => {
                event.stopPropagation();

                // Get cat data - è·å–çŒ«å’ªæ•°æ®
                const cat = catsData.find(c => c.id === catId);
                if (!cat || cat.images.length < 2) {
                    alert('éœ€è¦è‡³å°‘2å¼ å›¾ç‰‡æ‰èƒ½ç”ŸæˆGIFåŠ¨å›¾ï¼');
                    return;
                }

                // Disable button and show generating state - ç¦ç”¨æŒ‰é’®å¹¶æ˜¾ç¤ºç”ŸæˆçŠ¶æ€
                gifButton.disabled = true;
                gifButton.classList.add('generating');
                gifButton.textContent = 'â³';

                try {
                    // Prepare images for gifshot - ä¸º gifshot å‡†å¤‡å›¾ç‰‡
                    const imageElements = await Promise.all(
                        cat.images.map(src => loadImageForGif(src))
                    );

                    // Create GIF using gifshot - ä½¿ç”¨ gifshot åˆ›å»º GIF
                    gifshot.createGIF({
                        images: imageElements,
                        gifWidth: 500,
                        gifHeight: 400,
                        interval: 1, // 1 second per frame
                        numFrames: cat.images.length,
                        frameDuration: 1, // 1 second per frame
                        sampleInterval: 10,
                        numWorkers: 2
                    }, (obj) => {
                        if (!obj.error) {
                            // Download GIF - ä¸‹è½½ GIF
                            const link = document.createElement('a');
                            link.href = obj.image;
                            link.download = `${cat.name}-carousel.gif`;
                            link.click();

                            alert(`GIFåŠ¨å›¾ç”ŸæˆæˆåŠŸï¼å·²ä¿å­˜ä¸º ${cat.name}-carousel.gif`);
                        } else {
                            console.error('GIFç”Ÿæˆé”™è¯¯:', obj.error);
                            alert('GIFç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                        }

                        // Reset button - é‡ç½®æŒ‰é’®
                        gifButton.disabled = false;
                        gifButton.classList.remove('generating');
                        gifButton.textContent = 'ğŸ¬';
                    });

                } catch (error) {
                    console.error('GIFç”Ÿæˆé”™è¯¯:', error);
                    alert('GIFç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•ï¼');

                    // Reset button - é‡ç½®æŒ‰é’®
                    gifButton.disabled = false;
                    gifButton.classList.remove('generating');
                    gifButton.textContent = 'ğŸ¬';
                }
            });
        }

        /**
         * Load image and create canvas with proper sizing for GIF
         * åŠ è½½å›¾ç‰‡å¹¶åˆ›å»ºé€‚å½“å¤§å°çš„ç”»å¸ƒç”¨äº GIF
         * @param {string} src - Image source URL
         * @returns {Promise<HTMLCanvasElement>}
         */
        function loadImageForGif(src) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = 'anonymous';

                img.onload = () => {
                    // Create canvas and draw resized image - åˆ›å»ºç”»å¸ƒå¹¶ç»˜åˆ¶è°ƒæ•´å¤§å°çš„å›¾ç‰‡
                    const canvas = document.createElement('canvas');
                    canvas.width = 500;
                    canvas.height = 400;
                    const ctx = canvas.getContext('2d');

                    // Draw image with object-fit: cover effect - ä½¿ç”¨ cover æ•ˆæœç»˜åˆ¶å›¾ç‰‡
                    const imgRatio = img.width / img.height;
                    const canvasRatio = canvas.width / canvas.height;
                    let drawWidth, drawHeight, offsetX, offsetY;

                    if (imgRatio > canvasRatio) {
                        // Image is wider - å›¾ç‰‡æ›´å®½
                        drawHeight = canvas.height;
                        drawWidth = img.width * (canvas.height / img.height);
                        offsetX = (canvas.width - drawWidth) / 2;
                        offsetY = 0;
                    } else {
                        // Image is taller - å›¾ç‰‡æ›´é«˜
                        drawWidth = canvas.width;
                        drawHeight = img.height * (canvas.width / img.width);
                        offsetX = 0;
                        offsetY = (canvas.height - drawHeight) / 2;
                    }

                    ctx.drawImage(img, offsetX, offsetY, drawWidth, drawHeight);
                    resolve(canvas);
                };

                img.onerror = reject;
                img.src = src;
            });
        }

        /**
         * Handle image loading errors
         * å¤„ç†å›¾ç‰‡åŠ è½½é”™è¯¯
         * @param {Event} event - Error event
         */
        function handleImageError(event) {
            // Use a placeholder image on error - é”™è¯¯æ—¶ä½¿ç”¨å ä½å›¾ç‰‡
            event.target.src = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="500" height="400"%3E%3Crect fill="%23f0f0f0" width="500" height="400"/%3E%3Ctext fill="%23999" font-family="sans-serif" font-size="24" dy="200" dx="180"%3EçŒ«å’ªå›¾ç‰‡%3C/text%3E%3C/svg%3E';
        }

        // Add global error handler for images - ä¸ºå›¾ç‰‡æ·»åŠ å…¨å±€é”™è¯¯å¤„ç†
        document.addEventListener('error', (event) => {
            if (event.target.tagName === 'IMG') {
                handleImageError(event);
            }
        }, true);

        // ===========================================================
        // User Authentication Functions - ç”¨æˆ·è®¤è¯åŠŸèƒ½
        // ===========================================================

        // Current user state - å½“å‰ç”¨æˆ·çŠ¶æ€
        let currentUser = null;
        let authMode = 'login'; // 'login' or 'signup'

        /**
         * Initialize authentication - åˆå§‹åŒ–è®¤è¯
         */
        async function initAuth() {
            // Show auth bar - æ˜¾ç¤ºè®¤è¯æ 
            document.getElementById('authBar').style.display = 'flex';

            // Check if user is already logged in - æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
            if (supabaseEnabled && supabase) {
                const { data } = await supabase.auth.getSession();
                if (data.session) {
                    currentUser = data.session.user;
                    updateAuthUI();
                }
            }

            // Setup auth event listeners - è®¾ç½®è®¤è¯äº‹ä»¶ç›‘å¬
            setupAuthEventListeners();

            // Listen for auth state changes - ç›‘å¬è®¤è¯çŠ¶æ€å˜åŒ–
            if (supabaseEnabled && supabase) {
                supabase.auth.onAuthStateChange((event, session) => {
                    console.log('Auth state changed:', event);
                    if (session) {
                        currentUser = session.user;
                        updateAuthUI();
                    } else {
                        currentUser = null;
                        updateAuthUI();
                    }
                });
            }
        }

        /**
         * Setup authentication event listeners - è®¾ç½®è®¤è¯äº‹ä»¶ç›‘å¬
         */
        function setupAuthEventListeners() {
            const loginButton = document.getElementById('loginButton');
            const signupButton = document.getElementById('signupButton');
            const logoutButton = document.getElementById('logoutButton');
            const addCatButton = document.getElementById('addCatButton');
            const authModal = document.getElementById('authModal');
            const authForm = document.getElementById('authForm');
            const authSwitchLink = document.getElementById('authSwitchLink');

            // Login button - ç™»å½•æŒ‰é’®
            loginButton.addEventListener('click', () => {
                showAuthModal('login');
            });

            // Signup button - æ³¨å†ŒæŒ‰é’®
            signupButton.addEventListener('click', () => {
                showAuthModal('signup');
            });

            // Logout button - ç™»å‡ºæŒ‰é’®
            logoutButton.addEventListener('click', async () => {
                await handleLogout();
            });

            // Add cat button - æ·»åŠ çŒ«å’ªæŒ‰é’®
            addCatButton.addEventListener('click', () => {
                handleAddCat();
            });

            // Auth form submission - è®¤è¯è¡¨å•æäº¤
            authForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (authMode === 'login') {
                    await handleLogin();
                } else {
                    await handleSignup();
                }
            });

            // Switch between login and signup - åˆ‡æ¢ç™»å½•å’Œæ³¨å†Œ
            authSwitchLink.addEventListener('click', () => {
                if (authMode === 'login') {
                    showAuthModal('signup');
                } else {
                    showAuthModal('login');
                }
            });

            // Close modal when clicking outside - ç‚¹å‡»å¤–éƒ¨å…³é—­å¼¹çª—
            authModal.addEventListener('click', (e) => {
                if (e.target === authModal) {
                    hideAuthModal();
                }
            });
        }

        /**
         * Show auth modal - æ˜¾ç¤ºè®¤è¯å¼¹çª—
         * @param {string} mode - 'login' or 'signup'
         */
        function showAuthModal(mode) {
            authMode = mode;
            const modal = document.getElementById('authModal');
            const title = document.getElementById('modalTitle');
            const subtitle = document.getElementById('modalSubtitle');
            const submitButton = document.getElementById('authSubmitButton');
            const switchText = document.getElementById('authSwitchText');
            const switchLink = document.getElementById('authSwitchLink');
            const messageDiv = document.getElementById('authMessage');

            // Clear previous messages - æ¸…é™¤ä¹‹å‰çš„æ¶ˆæ¯
            messageDiv.innerHTML = '';

            // Reset form - é‡ç½®è¡¨å•
            document.getElementById('authEmail').value = '';
            document.getElementById('authPassword').value = '';

            if (mode === 'login') {
                title.textContent = 'ç™»å½•';
                subtitle.textContent = 'ç™»å½•ä»¥ç®¡ç†æ‚¨çš„çŒ«å’ª';
                submitButton.textContent = 'ç™»å½•';
                switchText.textContent = 'è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ';
                switchLink.textContent = 'æ³¨å†Œ';
            } else {
                title.textContent = 'æ³¨å†Œ';
                subtitle.textContent = 'åˆ›å»ºè´¦å·å¼€å§‹ç®¡ç†æ‚¨çš„çŒ«å’ª';
                submitButton.textContent = 'æ³¨å†Œ';
                switchText.textContent = 'å·²æœ‰è´¦å·ï¼Ÿ';
                switchLink.textContent = 'ç™»å½•';
            }

            modal.classList.add('active');
        }

        /**
         * Hide auth modal - éšè—è®¤è¯å¼¹çª—
         */
        function hideAuthModal() {
            const modal = document.getElementById('authModal');
            modal.classList.remove('active');
        }

        /**
         * Handle user login - å¤„ç†ç”¨æˆ·ç™»å½•
         */
        async function handleLogin() {
            if (!supabaseEnabled || !supabase) {
                showAuthMessage('Supabase æœªé…ç½®ï¼Œæ— æ³•ç™»å½•', 'error');
                return;
            }

            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            const submitButton = document.getElementById('authSubmitButton');

            submitButton.disabled = true;
            submitButton.textContent = 'ç™»å½•ä¸­...';

            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email,
                    password
                });

                if (error) throw error;

                currentUser = data.user;
                showAuthMessage('ç™»å½•æˆåŠŸï¼', 'success');

                setTimeout(() => {
                    hideAuthModal();
                    updateAuthUI();
                    // Reload cats to show user's own cats - é‡æ–°åŠ è½½çŒ«å’ªä»¥æ˜¾ç¤ºç”¨æˆ·è‡ªå·±çš„çŒ«å’ª
                    location.reload();
                }, 1000);

            } catch (error) {
                console.error('Login error:', error);
                showAuthMessage(error.message || 'ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥é‚®ç®±å’Œå¯†ç ', 'error');
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'ç™»å½•';
            }
        }

        /**
         * Handle user signup - å¤„ç†ç”¨æˆ·æ³¨å†Œ
         */
        async function handleSignup() {
            if (!supabaseEnabled || !supabase) {
                showAuthMessage('Supabase æœªé…ç½®ï¼Œæ— æ³•æ³¨å†Œ', 'error');
                return;
            }

            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            const submitButton = document.getElementById('authSubmitButton');

            if (password.length < 6) {
                showAuthMessage('å¯†ç è‡³å°‘éœ€è¦ 6 ä¸ªå­—ç¬¦', 'error');
                return;
            }

            submitButton.disabled = true;
            submitButton.textContent = 'æ³¨å†Œä¸­...';

            try {
                const { data, error } = await supabase.auth.signUp({
                    email,
                    password
                });

                if (error) throw error;

                showAuthMessage('æ³¨å†ŒæˆåŠŸï¼è¯·æ£€æŸ¥æ‚¨çš„é‚®ç®±ä»¥éªŒè¯è´¦å·ã€‚', 'success');

                // Show login form after 2 seconds - 2ç§’åæ˜¾ç¤ºç™»å½•è¡¨å•
                setTimeout(() => {
                    showAuthModal('login');
                }, 2000);

            } catch (error) {
                console.error('Signup error:', error);
                showAuthMessage(error.message || 'æ³¨å†Œå¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'æ³¨å†Œ';
            }
        }

        /**
         * Handle user logout - å¤„ç†ç”¨æˆ·ç™»å‡º
         */
        async function handleLogout() {
            if (!supabaseEnabled || !supabase) {
                return;
            }

            try {
                await supabase.auth.signOut();
                currentUser = null;
                updateAuthUI();
                // Reload to show all cats - é‡æ–°åŠ è½½ä»¥æ˜¾ç¤ºæ‰€æœ‰çŒ«å’ª
                location.reload();
            } catch (error) {
                console.error('Logout error:', error);
                alert('ç™»å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        /**
         * Handle add cat button - å¤„ç†æ·»åŠ çŒ«å’ªæŒ‰é’®
         */
        function handleAddCat() {
            if (!currentUser) {
                showAuthModal('login');
                return;
            }

            // Prompt user for cat details - æç¤ºç”¨æˆ·è¾“å…¥çŒ«å’ªè¯¦æƒ…
            const name = prompt('çŒ«å’ªåå­—ï¼š');
            if (!name) return;

            const breed = prompt('å“ç§ï¼š', 'ä¸­åç”°å›­çŒ«');
            const age = prompt('å¹´é¾„ï¼ˆå²ï¼‰ï¼š', '1');
            const sex = prompt('æ€§åˆ«ï¼ˆå…¬/æ¯ï¼‰ï¼š', 'å…¬');
            const description = prompt('æè¿°ï¼š', 'ä¸€åªå¯çˆ±çš„å°çŒ«å’ª');
            const tags = prompt('æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰ï¼š', 'å¯çˆ±,äº²äºº');

            // Create new cat - åˆ›å»ºæ–°çŒ«å’ª
            createNewCat({
                name,
                breed: breed || 'ä¸­åç”°å›­çŒ«',
                age,
                sex: sex === 'æ¯' ? 2 : 1,
                description: description || 'ä¸€åªå¯çˆ±çš„å°çŒ«å’ª',
                tags: tags || 'å¯çˆ±,äº²äºº'
            });
        }

        /**
         * Create a new cat - åˆ›å»ºæ–°çŒ«å’ª
         * @param {Object} catData - Cat data
         */
        async function createNewCat(catData) {
            if (!supabaseEnabled || !supabase || !currentUser) {
                alert('éœ€è¦ç™»å½•æ‰èƒ½æ·»åŠ çŒ«å’ª');
                return;
            }

            try {
                // ä¸è¦æŒ‡å®š idï¼Œè®©æ•°æ®åº“è‡ªåŠ¨ç”Ÿæˆ
                const { data, error } = await supabase
                    .from('cats')
                    .insert({
                        name: catData.name,
                        breed: catData.breed,
                        age: parseInt(catData.age) || 1,
                        sex: catData.sex,
                        description: catData.description,
                        tags: catData.tags,
                        user_id: currentUser.id,
                        images: []
                    })
                    .select()
                    .single();

                if (error) throw error;

                console.log('âœ“ çŒ«å’ªåˆ›å»ºæˆåŠŸ:', data);
                alert(`çŒ«å’ª "${catData.name}" æ·»åŠ æˆåŠŸï¼`);

                // Reload to show new cat - é‡æ–°åŠ è½½ä»¥æ˜¾ç¤ºæ–°çŒ«å’ª
                setTimeout(() => {
                    location.reload();
                }, 500);

            } catch (error) {
                console.error('Create cat error:', error);

                // æä¾›æ›´å‹å¥½çš„é”™è¯¯ä¿¡æ¯
                let errorMessage = 'æ·»åŠ çŒ«å’ªå¤±è´¥';
                if (error.message.includes('duplicate key')) {
                    errorMessage = 'æ•°æ®åº“IDå†²çªï¼Œè¯·é‡è¯•';
                } else if (error.message.includes('violates row-level security')) {
                    errorMessage = 'æƒé™ä¸è¶³ï¼Œè¯·ç¡®ä¿å·²ç™»å½•';
                } else {
                    errorMessage = error.message;
                }

                alert('æ·»åŠ çŒ«å’ªå¤±è´¥: ' + errorMessage);
            }
        }

        /**
         * Update authentication UI - æ›´æ–°è®¤è¯ç•Œé¢
         */
        function updateAuthUI() {
            const loggedOutDiv = document.getElementById('authLoggedOut');
            const loggedInDiv = document.getElementById('authLoggedIn');
            const userEmailSpan = document.getElementById('userEmail');

            if (currentUser) {
                // User is logged in - ç”¨æˆ·å·²ç™»å½•
                loggedOutDiv.style.display = 'none';
                loggedInDiv.style.display = 'flex';
                userEmailSpan.textContent = currentUser.email;
                console.log('âœ“ ç”¨æˆ·å·²ç™»å½•:', currentUser.email);
            } else {
                // User is logged out - ç”¨æˆ·æœªç™»å½•
                loggedOutDiv.style.display = 'flex';
                loggedInDiv.style.display = 'none';
                console.log('âš  ç”¨æˆ·æœªç™»å½•');
            }
        }

        /**
         * Show auth message - æ˜¾ç¤ºè®¤è¯æ¶ˆæ¯
         * @param {string} message - Message text
         * @param {string} type - 'success' or 'error'
         */
        function showAuthMessage(message, type) {
            const messageDiv = document.getElementById('authMessage');
            messageDiv.className = type === 'success' ? 'auth-success' : 'auth-error';
            messageDiv.textContent = message;
        }

        // ===========================================================
        // Initialize App - åˆå§‹åŒ–åº”ç”¨
        // ===========================================================

        // Initialize when DOM is ready - DOMå‡†å¤‡å¥½ååˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                initAuth();
                initCatCards();
            });
        } else {
            initAuth();
            initCatCards();
        }
    </script>
</body>
</html>