<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å–µå®‡å®™ - çŒ«å’ªå±•ç¤ºå¡ç‰‡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            width: 100%;
        }

        .title {
            text-align: center;
            color: white;
            font-size: 2.5rem;
            margin-bottom: 40px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            padding: 20px;
        }

        /* Cat card styling */
        .cat-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .cat-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        .cat-image-container {
            width: 100%;
            height: 250px;
            overflow: hidden;
            background: #f5f5f5;
            position: relative;
        }

        .cat-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .cat-card:hover .cat-image {
            transform: scale(1.1);
        }

        .cat-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.95);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* Photo upload button styling */
        .upload-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(102, 126, 234, 0.95);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 20;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            pointer-events: none;
        }

        .upload-button:hover {
            background: rgba(102, 126, 234, 1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .cat-image-container:hover .upload-button {
            opacity: 1;
            pointer-events: auto;
        }

        .cat-image-container:hover::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 5;
        }

        /* Hide file input */
        .file-input {
            display: none;
        }

        /* GIF generation button - ç”ŸæˆGIFæŒ‰é’® */
        .gif-button {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.8);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
            opacity: 0.6;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .gif-button:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.95);
            transform: scale(1.1);
        }

        .gif-button.generating {
            background: rgba(102, 126, 234, 0.9);
            color: white;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* Carousel controls - è½®æ’­å›¾æ§åˆ¶ */
        .carousel-nav {
            position: absolute;
            top: 50%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 10px;
            transform: translateY(-50%);
            z-index: 15;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .cat-image-container:hover .carousel-nav {
            opacity: 1;
            pointer-events: auto;
        }

        .carousel-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .carousel-btn:hover {
            background: white;
            transform: scale(1.1);
        }

        .carousel-indicator {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            z-index: 15;
        }

        /* Edit button - ç¼–è¾‘æŒ‰é’® */
        .edit-button {
            display: block;
            width: 100%;
            padding: 10px;
            margin-top: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .edit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        /* Edit mode styling - ç¼–è¾‘æ¨¡å¼æ ·å¼ */
        .cat-card.editing {
            border: 3px solid #667eea;
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.3);
        }

        .cat-card.editing .cat-card:hover {
            transform: none;
        }

        .edit-input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
            background: #f8f9ff;
        }

        .edit-input:focus {
            outline: none;
            border-color: #764ba2;
            background: white;
        }

        .edit-input.small {
            font-size: 1.1rem;
            font-weight: 400;
        }

        .edit-input.tiny {
            font-size: 0.9rem;
        }

        .stat-item input.edit-input {
            width: 100%;
            padding: 5px 8px;
            text-align: center;
        }

        .edit-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .edit-actions button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .save-button {
            background: #28a745;
            color: white;
        }

        .save-button:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .cancel-button {
            background: #6c757d;
            color: white;
        }

        .cancel-button:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .cat-info {
            padding: 20px;
        }

        .cat-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .cat-breed {
            color: #667eea;
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .cat-description {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .cat-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .stat-item {
            flex: 1;
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #999;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: #333;
        }

        .cat-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag {
            padding: 5px 12px;
            background: #e9ecef;
            color: #495057;
            border-radius: 15px;
            font-size: 0.8rem;
        }

        /* Loading animation */
        .loading {
            text-align: center;
            color: white;
            font-size: 1.2rem;
        }

        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .title {
                font-size: 2rem;
            }

            .cards-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">ğŸ± å–µå®‡å®™ </h1>
        <div id="cardsContainer" class="cards-grid">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>åŠ è½½ä¸­...</p>
            </div>
        </div>
    </div>

    <!-- GIF generation library -->
    <script src="https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.js"></script>

    <script>
        // Sample cat data - ç¤ºä¾‹çŒ«å’ªæ•°æ®
        const catsData = [
            {
                id: 1,
                name: "å°æ©˜",
                breed: "æ©˜çŒ«",
                age: "2å²",
                gender: "å…¬",
                description: "æ€§æ ¼æ¸©é¡ºï¼Œå–œæ¬¢æ™’å¤ªé˜³ï¼Œå¯¹å°é±¼å¹²æ²¡æœ‰æŠµæŠ—åŠ›ã€‚æ˜¯ä¸ªä¸æŠ˜ä¸æ‰£çš„åƒè´§ï¼Œçœ‹è§é£Ÿç‰©å°±ä¼šå–µå–µå«ã€‚",
                images: ["https://images.unsplash.com/photo-1574158622682-e40e69881006?w=500&h=400&fit=crop"],
                badge: "æœ€å—æ¬¢è¿",
                tags: ["æ¸©é¡º", "äº²äºº", "åƒè´§"]
            },
            {
                id: 2,
                name: "é›ªçƒ",
                breed: "è‹±å›½çŸ­æ¯›çŒ«",
                age: "1å²",
                gender: "æ¯",
                description: "ä¼˜é›…çš„å°å…¬ä¸»ï¼Œæ¯›è‰²é›ªç™½çº¯å‡€ï¼Œçœ¼ç›æ˜¯æ¼‚äº®çš„è“è‰²ã€‚å–œæ¬¢å®‰é™çš„ç¯å¢ƒï¼Œå¶å°”ä¼šé«˜å†·ã€‚",
                images: ["https://images.unsplash.com/photo-1513360371669-4adf3dd7dff8?w=500&h=400&fit=crop"],
                badge: "æ–°æˆå‘˜",
                tags: ["ä¼˜é›…", "å®‰é™", "é«˜å†·"]
            },
            {
                id: 3,
                name: "è™æ–‘",
                breed: "ç¾å›½çŸ­æ¯›çŒ«",
                age: "3å²",
                gender: "å…¬",
                description: "æ´»åŠ›åè¶³çš„è¿åŠ¨å¥å°†ï¼Œå–œæ¬¢çˆ¬é«˜ä¸Šä½ï¼Œå¯¹é€—çŒ«æ£’å’Œæ¿€å…‰ç¬”éå¸¸æ„Ÿå…´è¶£ã€‚",
                images: ["https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?w=500&h=400&fit=crop"],
                badge: "æ´»åŠ›ä¹‹æ˜Ÿ",
                tags: ["æ´»æ³¼", "å¥½åŠ¨", "çˆ±ç©"]
            },
            {
                id: 4,
                name: "å¸ƒä¸",
                breed: "å¸ƒå¶çŒ«",
                age: "1.5å²",
                gender: "æ¯",
                description: "æ‹¥æœ‰æ·±è“è‰²çš„çœ¼ç›å’ŒæŸ”è½¯çš„é•¿æ¯›ï¼Œæ€§æ ¼æ¸©æŸ”ä½“è´´ï¼Œæ˜¯å®Œç¾çš„é™ªä¼´å‹çŒ«å’ªã€‚",
                images: ["https://images.unsplash.com/photo-1529778873920-4da4926a72c2?w=500&h=400&fit=crop"],
                badge: "æ¸©æŸ”å¤©ä½¿",
                tags: ["æ¸©æŸ”", "ç²˜äºº", "é¢œå€¼é«˜"]
            },
            {
                id: 5,
                name: "é»‘ç‚­",
                breed: "é»‘çŒ«",
                age: "4å²",
                gender: "å…¬",
                description: "å…¨èº«ä¹Œé»‘å‘äº®ï¼Œçœ¼ç›åœ¨é»‘æš—ä¸­ä¼šå‘å‡ºç¥ç§˜çš„ç»¿å…‰ã€‚æ€§æ ¼ç‹¬ç«‹ï¼Œä½†å¯¹ä¸»äººéå¸¸å¿ è¯šã€‚",
                images: ["https://images.unsplash.com/photo-1494256997604-768d1f608cac?w=500&h=400&fit=crop"],
                badge: "ç¥ç§˜ä½¿è€…",
                tags: ["ç‹¬ç«‹", "å¿ è¯š", "ç¥ç§˜"]
            },
            {
                id: 6,
                name: "å¥¶èŒ¶",
                breed: "æš¹ç½—çŒ«",
                age: "2.5å²",
                gender: "æ¯",
                description: "æ‹¥æœ‰ç‹¬ç‰¹çš„é‡ç‚¹è‰²èŠ±çº¹å’Œè“å®çŸ³èˆ¬çš„çœ¼ç›ã€‚æ€§æ ¼æ´»æ³¼ï¼Œå–œæ¬¢ä¸äººäº¤æµï¼Œå«å£°ç‹¬ç‰¹ã€‚",
                images: ["https://images.unsplash.com/photo-1543852786-1cf6624b9987?w=500&h=400&fit=crop"],
                badge: "è¯ç—¨å°å§",
                tags: ["æ´»æ³¼", "å¥è°ˆ", "èªæ˜"]
            }
        ];

        /**
         * Initialize the cat cards display
         * åˆå§‹åŒ–çŒ«å’ªå¡ç‰‡å±•ç¤º
         */
        function initCatCards() {
            const container = document.getElementById('cardsContainer');

            // Simulate loading delay - æ¨¡æ‹ŸåŠ è½½å»¶è¿Ÿ
            setTimeout(() => {
                container.innerHTML = '';

                // Render each cat card - æ¸²æŸ“æ¯ä¸ªçŒ«å’ªå¡ç‰‡
                catsData.forEach(cat => {
                    const card = createCatCard(cat);
                    container.appendChild(card);
                });

                // Load saved images after cards are rendered - å¡ç‰‡æ¸²æŸ“ååŠ è½½ä¿å­˜çš„å›¾ç‰‡
                setTimeout(() => {
                    loadSavedImages();
                }, 100);
            }, 800);
        }

        /**
         * Create a single cat card element
         * åˆ›å»ºå•ä¸ªçŒ«å’ªå¡ç‰‡å…ƒç´ 
         * @param {Object} cat - Cat data object
         * @returns {HTMLElement} - Card element
         */
        function createCatCard(cat) {
            // Create card container - åˆ›å»ºå¡ç‰‡å®¹å™¨
            const card = document.createElement('div');
            card.className = 'cat-card';
            card.setAttribute('data-cat-id', cat.id);

            // Build card HTML - æ„å»ºå¡ç‰‡HTML
            card.innerHTML = `
                <div class="cat-image-container">
                    <img src="${cat.images[0]}" alt="${cat.name}" class="cat-image" data-cat-id="${cat.id}">
                    <div class="cat-badge">${cat.badge}</div>
                    <button class="upload-button" data-cat-id="${cat.id}">ğŸ“· é€‰æ‹©ç…§ç‰‡</button>
                    <input type="file" class="file-input" accept="image/*" multiple data-cat-id="${cat.id}">
                    <button class="gif-button" data-cat-id="${cat.id}" title="ç”Ÿæˆè½®æ’­GIF">ğŸ¬</button>
                    <div class="carousel-nav">
                        <button class="carousel-btn prev-btn">â€¹</button>
                        <button class="carousel-btn next-btn">â€º</button>
                    </div>
                    <div class="carousel-indicator">1/${cat.images.length}</div>
                </div>
                <div class="cat-info">
                    <h2 class="cat-name">${cat.name}</h2>
                    <div class="cat-breed">${cat.breed}</div>
                    <p class="cat-description">${cat.description}</p>
                    <div class="cat-stats">
                        <div class="stat-item">
                            <div class="stat-label">å¹´é¾„</div>
                            <div class="stat-value">${cat.age}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">æ€§åˆ«</div>
                            <div class="stat-value">${cat.gender}</div>
                        </div>
                    </div>
                    <div class="cat-tags">
                        ${cat.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                    <button class="edit-button">âœï¸ ç¼–è¾‘ä¿¡æ¯</button>
                </div>
            `;

            // Setup photo upload functionality - è®¾ç½®ç…§ç‰‡ä¸Šä¼ åŠŸèƒ½
            setupPhotoUpload(card, cat.id);

            // Setup carousel functionality - è®¾ç½®è½®æ’­åŠŸèƒ½
            setupCarousel(card, cat.id);

            // Setup edit functionality - è®¾ç½®ç¼–è¾‘åŠŸèƒ½
            setupEditMode(card, cat);

            // Setup GIF generation functionality - è®¾ç½®GIFç”ŸæˆåŠŸèƒ½
            setupGifGeneration(card, cat.id);

            return card;
        }

        /**
         * Setup photo upload functionality for a cat card
         * ä¸ºçŒ«å’ªå¡ç‰‡è®¾ç½®ç…§ç‰‡ä¸Šä¼ åŠŸèƒ½
         * @param {HTMLElement} card - Card element
         * @param {number} catId - Cat ID
         */
        function setupPhotoUpload(card, catId) {
            const uploadButton = card.querySelector('.upload-button');
            const fileInput = card.querySelector('.file-input');

            // Click upload button to trigger file input - ç‚¹å‡»ä¸Šä¼ æŒ‰é’®è§¦å‘æ–‡ä»¶é€‰æ‹©
            uploadButton.addEventListener('click', (event) => {
                event.stopPropagation(); // Prevent card click event - é˜»æ­¢å¡ç‰‡ç‚¹å‡»äº‹ä»¶
                fileInput.click();
            });

            // Handle multiple file selection - å¤„ç†å¤šæ–‡ä»¶é€‰æ‹©
            fileInput.addEventListener('change', (event) => {
                const files = Array.from(event.target.files);

                // Validate files - éªŒè¯æ–‡ä»¶
                if (files.length === 0) {
                    return;
                }

                // Check all files are images - æ£€æŸ¥æ‰€æœ‰æ–‡ä»¶éƒ½æ˜¯å›¾ç‰‡
                const validFiles = files.filter(file => file.type.startsWith('image/'));

                if (validFiles.length === 0) {
                    alert('è¯·é€‰æ‹©æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶');
                    return;
                }

                // Process and add multiple images - å¤„ç†å¹¶æ·»åŠ å¤šå¼ å›¾ç‰‡
                processMultipleImages(validFiles, catId, card);
            });
        }

        /**
         * Process multiple uploaded images
         * å¤„ç†å¤šå¼ ä¸Šä¼ çš„å›¾ç‰‡
         * @param {File[]} files - Array of image files
         * @param {number} catId - Cat ID
         * @param {HTMLElement} card - Card element
         */
        function processMultipleImages(files, catId, card) {
            const imagePromises = files.map(file => {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            });

            // Wait for all images to be read - ç­‰å¾…æ‰€æœ‰å›¾ç‰‡è¯»å–å®Œæˆ
            Promise.all(imagePromises).then(newImageUrls => {
                // Find cat data and update images - æŸ¥æ‰¾çŒ«å’ªæ•°æ®å¹¶æ›´æ–°å›¾ç‰‡
                const cat = catsData.find(c => c.id === catId);
                if (cat) {
                    // Append new images to existing images - å°†æ–°å›¾ç‰‡è¿½åŠ åˆ°ç°æœ‰å›¾ç‰‡åˆ—è¡¨
                    cat.images = [...cat.images, ...newImageUrls];

                    // Save to localStorage - ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                    try {
                        localStorage.setItem(`cat-images-${catId}`, JSON.stringify(cat.images));
                    } catch (e) {
                        console.warn('æ— æ³•ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°å­˜å‚¨:', e);
                    }

                    // Update display to show the first new image - æ›´æ–°æ˜¾ç¤ºï¼Œæ˜¾ç¤ºç¬¬ä¸€å¼ æ–°å›¾ç‰‡
                    const imgElement = card.querySelector('.cat-image');
                    const currentIndex = cat.images.length - newImageUrls.length;
                    imgElement.src = cat.images[currentIndex];

                    // Update indicator - æ›´æ–°æŒ‡ç¤ºå™¨
                    const indicator = card.querySelector('.carousel-indicator');
                    indicator.textContent = `${currentIndex + 1}/${cat.images.length}`;

                    // Update carousel index - æ›´æ–°è½®æ’­ç´¢å¼•
                    card.carouselIndex = currentIndex;

                    // Stop existing autoplay if any - åœæ­¢ç°æœ‰çš„è‡ªåŠ¨æ’­æ”¾
                    if (card.carouselInterval) {
                        clearInterval(card.carouselInterval);
                    }

                    // Restart autoplay if more than 1 image - å¦‚æœæœ‰å¤šå¼ å›¾ç‰‡åˆ™é‡å¯è‡ªåŠ¨æ’­æ”¾
                    if (cat.images.length > 1) {
                        card.carouselInterval = setInterval(() => {
                            const images = cat.images;
                            if (images.length > 0) {
                                card.carouselIndex = (card.carouselIndex + 1) % images.length;
                                imgElement.src = images[card.carouselIndex];
                                indicator.textContent = `${card.carouselIndex + 1}/${images.length}`;
                            }
                        }, 3000);
                    }
                }
            }).catch((error) => {
                console.error('å›¾ç‰‡è¯»å–é”™è¯¯:', error);
                alert('å›¾ç‰‡è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•');
            });
        }

        /**
         * Setup carousel functionality for a cat card
         * ä¸ºçŒ«å’ªå¡ç‰‡è®¾ç½®è½®æ’­åŠŸèƒ½
         * @param {HTMLElement} card - Card element
         * @param {number} catId - Cat ID
         */
        function setupCarousel(card, catId) {
            const imgElement = card.querySelector('.cat-image');
            const indicator = card.querySelector('.carousel-indicator');
            const prevBtn = card.querySelector('.prev-btn');
            const nextBtn = card.querySelector('.next-btn');

            // Initialize carousel index - åˆå§‹åŒ–è½®æ’­ç´¢å¼•
            card.carouselIndex = 0;
            card.carouselInterval = null;

            // Get current cat images - è·å–å½“å‰çŒ«å’ªçš„å›¾ç‰‡
            function getCatImages() {
                const cat = catsData.find(c => c.id === catId);
                return cat ? cat.images : [];
            }

            // Show image at specific index - æ˜¾ç¤ºæŒ‡å®šç´¢å¼•çš„å›¾ç‰‡
            function showImage(index) {
                const images = getCatImages();
                if (images.length === 0) return;

                card.carouselIndex = (index + images.length) % images.length;
                imgElement.src = images[card.carouselIndex];
                indicator.textContent = `${card.carouselIndex + 1}/${images.length}`;
            }

            // Navigate to previous image - åˆ‡æ¢åˆ°ä¸Šä¸€å¼ 
            function prevImage(event) {
                event.stopPropagation();
                stopAutoPlay();
                showImage(card.carouselIndex - 1);
                startAutoPlay();
            }

            // Navigate to next image - åˆ‡æ¢åˆ°ä¸‹ä¸€å¼ 
            function nextImage(event) {
                event.stopPropagation();
                stopAutoPlay();
                showImage(card.carouselIndex + 1);
                startAutoPlay();
            }

            // Start auto play - å¼€å§‹è‡ªåŠ¨æ’­æ”¾
            function startAutoPlay() {
                const images = getCatImages();
                if (images.length <= 1) return;

                stopAutoPlay();
                card.carouselInterval = setInterval(() => {
                    showImage(card.carouselIndex + 1);
                }, 3000);
            }

            // Stop auto play - åœæ­¢è‡ªåŠ¨æ’­æ”¾
            function stopAutoPlay() {
                if (card.carouselInterval) {
                    clearInterval(card.carouselInterval);
                    card.carouselInterval = null;
                }
            }

            // Add event listeners - æ·»åŠ äº‹ä»¶ç›‘å¬
            prevBtn.addEventListener('click', prevImage);
            nextBtn.addEventListener('click', nextImage);

            // Start auto play when card is created - å¡ç‰‡åˆ›å»ºæ—¶å¼€å§‹è‡ªåŠ¨æ’­æ”¾
            startAutoPlay();

            // Pause on hover - æ‚¬åœæ—¶æš‚åœ
            card.addEventListener('mouseenter', stopAutoPlay);
            card.addEventListener('mouseleave', startAutoPlay);
        }

        /**
         * Setup edit mode functionality for a cat card
         * ä¸ºçŒ«å’ªå¡ç‰‡è®¾ç½®ç¼–è¾‘æ¨¡å¼åŠŸèƒ½
         * @param {HTMLElement} card - Card element
         * @param {Object} cat - Cat data object
         */
        function setupEditMode(card, cat) {
            const editButton = card.querySelector('.edit-button');
            const catInfo = card.querySelector('.cat-info');

            // Store original data - å­˜å‚¨åŸå§‹æ•°æ®
            let originalData = { ...cat };

            editButton.addEventListener('click', (event) => {
                event.stopPropagation();

                // Check if already editing - æ£€æŸ¥æ˜¯å¦å·²ç»åœ¨ç¼–è¾‘
                if (card.classList.contains('editing')) {
                    return;
                }

                // Enter edit mode - è¿›å…¥ç¼–è¾‘æ¨¡å¼
                card.classList.add('editing');

                // Replace display elements with inputs - ç”¨è¾“å…¥æ¡†æ›¿æ¢æ˜¾ç¤ºå…ƒç´ 
                const nameElement = catInfo.querySelector('.cat-name');
                const breedElement = catInfo.querySelector('.cat-breed');
                const descElement = catInfo.querySelector('.cat-description');
                const ageElement = catInfo.querySelector('.stat-value:nth-child(1)');
                const tagsContainer = catInfo.querySelector('.cat-tags');

                catInfo.innerHTML = `
                    <input type="text" class="edit-input" value="${cat.name}" data-field="name" placeholder="çŒ«å’ªåå­—">
                    <input type="text" class="edit-input small" value="${cat.breed}" data-field="breed" placeholder="å“ç§">
                    <input type="text" class="edit-input tiny" value="${cat.description}" data-field="description" placeholder="æè¿°">
                    <div class="cat-stats">
                        <div class="stat-item">
                            <div class="stat-label">å¹´é¾„</div>
                            <input type="text" class="edit-input small stat-value" value="${cat.age}" data-field="age" placeholder="å¹´é¾„">
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">æ€§åˆ«</div>
                            <div class="stat-value">${cat.gender}</div>
                        </div>
                    </div>
                    <input type="text" class="edit-input tiny" value="${cat.tags.join(', ')}" data-field="tags" placeholder="æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰">
                    <div class="edit-actions">
                        <button class="save-button">ğŸ’¾ ä¿å­˜</button>
                        <button class="cancel-button">âŒ å–æ¶ˆ</button>
                    </div>
                `;

                // Setup save and cancel buttons - è®¾ç½®ä¿å­˜å’Œå–æ¶ˆæŒ‰é’®
                const saveBtn = catInfo.querySelector('.save-button');
                const cancelBtn = catInfo.querySelector('.cancel-button');

                saveBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    saveEdit(card, cat, catInfo);
                });

                cancelBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    cancelEdit(card, cat, catInfo, originalData);
                });
            });
        }

        /**
         * Save edited information
         * ä¿å­˜ç¼–è¾‘çš„ä¿¡æ¯
         * @param {HTMLElement} card - Card element
         * @param {Object} cat - Cat data object
         * @param {HTMLElement} catInfo - Cat info element
         */
        function saveEdit(card, cat, catInfo) {
            // Get new values from inputs - ä»è¾“å…¥æ¡†è·å–æ–°å€¼
            const nameInput = catInfo.querySelector('[data-field="name"]');
            const breedInput = catInfo.querySelector('[data-field="breed"]');
            const descInput = catInfo.querySelector('[data-field="description"]');
            const ageInput = catInfo.querySelector('[data-field="age"]');
            const tagsInput = catInfo.querySelector('[data-field="tags"]');

            // Update cat data - æ›´æ–°çŒ«å’ªæ•°æ®
            cat.name = nameInput.value.trim() || cat.name;
            cat.breed = breedInput.value.trim() || cat.breed;
            cat.description = descInput.value.trim() || cat.description;
            cat.age = ageInput.value.trim() || cat.age;
            cat.tags = tagsInput.value.split(',').map(t => t.trim()).filter(t => t);

            // Save to localStorage - ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            try {
                localStorage.setItem(`cat-data-${cat.id}`, JSON.stringify(cat));
            } catch (e) {
                console.warn('æ— æ³•ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨:', e);
            }

            // Exit edit mode and restore display - é€€å‡ºç¼–è¾‘æ¨¡å¼å¹¶æ¢å¤æ˜¾ç¤º
            restoreDisplayMode(card, cat, catInfo);
        }

        /**
         * Cancel editing and restore original data
         * å–æ¶ˆç¼–è¾‘å¹¶æ¢å¤åŸå§‹æ•°æ®
         * @param {HTMLElement} card - Card element
         * @param {Object} cat - Cat data object
         * @param {HTMLElement} catInfo - Cat info element
         * @param {Object} originalData - Original cat data
         */
        function cancelEdit(card, cat, catInfo, originalData) {
            // Restore original data - æ¢å¤åŸå§‹æ•°æ®
            Object.assign(cat, originalData);

            // Exit edit mode and restore display - é€€å‡ºç¼–è¾‘æ¨¡å¼å¹¶æ¢å¤æ˜¾ç¤º
            restoreDisplayMode(card, cat, catInfo);
        }

        /**
         * Restore display mode from edit mode
         * ä»ç¼–è¾‘æ¨¡å¼æ¢å¤æ˜¾ç¤ºæ¨¡å¼
         * @param {HTMLElement} card - Card element
         * @param {Object} cat - Cat data object
         * @param {HTMLElement} catInfo - Cat info element
         */
        function restoreDisplayMode(card, cat, catInfo) {
            // Remove editing class - ç§»é™¤ç¼–è¾‘ç±»
            card.classList.remove('editing');

            // Restore display HTML - æ¢å¤æ˜¾ç¤ºHTML
            catInfo.innerHTML = `
                <h2 class="cat-name">${cat.name}</h2>
                <div class="cat-breed">${cat.breed}</div>
                <p class="cat-description">${cat.description}</p>
                <div class="cat-stats">
                    <div class="stat-item">
                        <div class="stat-label">å¹´é¾„</div>
                        <div class="stat-value">${cat.age}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">æ€§åˆ«</div>
                        <div class="stat-value">${cat.gender}</div>
                    </div>
                </div>
                <div class="cat-tags">
                    ${cat.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                </div>
                <button class="edit-button">âœï¸ ç¼–è¾‘ä¿¡æ¯</button>
            `;

            // Re-setup edit button - é‡æ–°è®¾ç½®ç¼–è¾‘æŒ‰é’®
            const editButton = catInfo.querySelector('.edit-button');
            editButton.addEventListener('click', (event) => {
                event.stopPropagation();
                setupEditMode(card, cat);
                editButton.click();
            });
        }

        /**
         * Load saved images and data from localStorage
         * ä»æœ¬åœ°å­˜å‚¨åŠ è½½ä¿å­˜çš„å›¾ç‰‡å’Œæ•°æ®
         */
        function loadSavedImages() {
            catsData.forEach(cat => {
                // Load multiple images - åŠ è½½å¤šå¼ å›¾ç‰‡
                const savedImages = localStorage.getItem(`cat-images-${cat.id}`);
                if (savedImages) {
                    try {
                        cat.images = JSON.parse(savedImages);
                    } catch (e) {
                        console.warn('æ— æ³•è§£æä¿å­˜çš„å›¾ç‰‡æ•°æ®:', e);
                    }
                }

                // Load saved cat data - åŠ è½½ä¿å­˜çš„çŒ«å’ªæ•°æ®
                const savedData = localStorage.getItem(`cat-data-${cat.id}`);
                if (savedData) {
                    try {
                        const data = JSON.parse(savedData);
                        Object.assign(cat, data);
                    } catch (e) {
                        console.warn('æ— æ³•è§£æä¿å­˜çš„æ•°æ®:', e);
                    }
                }

                // Update display - æ›´æ–°æ˜¾ç¤º
                const card = document.querySelector(`.cat-card[data-cat-id="${cat.id}"]`);
                if (card) {
                    // Update image - æ›´æ–°å›¾ç‰‡
                    const imgElement = card.querySelector('.cat-image');
                    if (imgElement && cat.images[0]) {
                        imgElement.src = cat.images[0];
                    }

                    // Update indicator - æ›´æ–°æŒ‡ç¤ºå™¨
                    const indicator = card.querySelector('.carousel-indicator');
                    if (indicator) {
                        indicator.textContent = `1/${cat.images.length}`;
                    }

                    // Update cat info display - æ›´æ–°çŒ«å’ªä¿¡æ¯æ˜¾ç¤º
                    const catInfo = card.querySelector('.cat-info');
                    if (catInfo) {
                        const nameElement = catInfo.querySelector('.cat-name');
                        const breedElement = catInfo.querySelector('.cat-breed');
                        const descElement = catInfo.querySelector('.cat-description');
                        const ageElement = catInfo.querySelector('.stat-value');
                        const tagsContainer = catInfo.querySelector('.cat-tags');

                        if (nameElement) nameElement.textContent = cat.name;
                        if (breedElement) breedElement.textContent = cat.breed;
                        if (descElement) descElement.textContent = cat.description;
                        if (ageElement) ageElement.textContent = cat.age;
                        if (tagsContainer) {
                            tagsContainer.innerHTML = cat.tags.map(tag => `<span class="tag">${tag}</span>`).join('');
                        }
                    }
                }
            });
        }


        /**
         * Setup GIF generation functionality for a cat card
         * ä¸ºçŒ«å’ªå¡ç‰‡è®¾ç½®GIFç”ŸæˆåŠŸèƒ½
         * @param {HTMLElement} card - Card element
         * @param {number} catId - Cat ID
         */
        function setupGifGeneration(card, catId) {
            const gifButton = card.querySelector('.gif-button');
            const imgElement = card.querySelector('.cat-image');

            gifButton.addEventListener('click', async (event) => {
                event.stopPropagation();

                // Get cat data - è·å–çŒ«å’ªæ•°æ®
                const cat = catsData.find(c => c.id === catId);
                if (!cat || cat.images.length < 2) {
                    alert('éœ€è¦è‡³å°‘2å¼ å›¾ç‰‡æ‰èƒ½ç”ŸæˆGIFåŠ¨å›¾ï¼');
                    return;
                }

                // Disable button and show generating state - ç¦ç”¨æŒ‰é’®å¹¶æ˜¾ç¤ºç”ŸæˆçŠ¶æ€
                gifButton.disabled = true;
                gifButton.classList.add('generating');
                gifButton.textContent = 'â³';

                try {
                    // Create GIF encoder - åˆ›å»ºGIFç¼–ç å™¨
                    const gif = new GIF({
                        workers: 2,
                        quality: 10,
                        width: 500,
                        height: 400,
                        workerScript: 'https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.worker.js'
                    });

                    // Load and add all images to GIF - åŠ è½½å¹¶æ·»åŠ æ‰€æœ‰å›¾ç‰‡åˆ°GIF
                    for (let i = 0; i < cat.images.length; i++) {
                        const img = await loadImage(cat.images[i]);

                        // Create canvas and draw resized image - åˆ›å»ºç”»å¸ƒå¹¶ç»˜åˆ¶è°ƒæ•´å¤§å°çš„å›¾ç‰‡
                        const canvas = document.createElement('canvas');
                        canvas.width = 500;
                        canvas.height = 400;
                        const ctx = canvas.getContext('2d');

                        // Draw image with object-fit: cover effect - ä½¿ç”¨coveræ•ˆæœç»˜åˆ¶å›¾ç‰‡
                        const imgRatio = img.width / img.height;
                        const canvasRatio = canvas.width / canvas.height;
                        let drawWidth, drawHeight, offsetX, offsetY;

                        if (imgRatio > canvasRatio) {
                            // Image is wider - å›¾ç‰‡æ›´å®½
                            drawHeight = canvas.height;
                            drawWidth = img.width * (canvas.height / img.height);
                            offsetX = (canvas.width - drawWidth) / 2;
                            offsetY = 0;
                        } else {
                            // Image is taller - å›¾ç‰‡æ›´é«˜
                            drawWidth = canvas.width;
                            drawHeight = img.height * (canvas.width / img.width);
                            offsetX = 0;
                            offsetY = (canvas.height - drawHeight) / 2;
                        }

                        ctx.drawImage(img, offsetX, offsetY, drawWidth, drawHeight);

                        // Add frame to GIF with 1 second delay - æ·»åŠ å¸§åˆ°GIFï¼Œå»¶è¿Ÿ1ç§’
                        gif.addFrame(canvas, { delay: 1000 });
                    }

                    // Render GIF - æ¸²æŸ“GIF
                    gif.on('finished', (blob) => {
                        // Download GIF - ä¸‹è½½GIF
                        const url = URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = `${cat.name}-carousel.gif`;
                        link.click();
                        URL.revokeObjectURL(url);

                        // Reset button - é‡ç½®æŒ‰é’®
                        gifButton.disabled = false;
                        gifButton.classList.remove('generating');
                        gifButton.textContent = 'ğŸ¬';

                        alert(`GIFåŠ¨å›¾ç”ŸæˆæˆåŠŸï¼å·²ä¿å­˜ä¸º ${cat.name}-carousel.gif`);
                    });

                    gif.render();

                } catch (error) {
                    console.error('GIFç”Ÿæˆé”™è¯¯:', error);
                    alert('GIFç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•ï¼');

                    // Reset button - é‡ç½®æŒ‰é’®
                    gifButton.disabled = false;
                    gifButton.classList.remove('generating');
                    gifButton.textContent = 'ğŸ¬';
                }
            });
        }

        /**
         * Load image and return as Image element
         * åŠ è½½å›¾ç‰‡å¹¶è¿”å›Imageå…ƒç´ 
         * @param {string} src - Image source URL
         * @returns {Promise<HTMLImageElement>}
         */
        function loadImage(src) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.onload = () => resolve(img);
                img.onerror = reject;
                img.src = src;
            });
        }

        /**
         * Handle image loading errors
         * å¤„ç†å›¾ç‰‡åŠ è½½é”™è¯¯
         * @param {Event} event - Error event
         */
        function handleImageError(event) {
            // Use a placeholder image on error - é”™è¯¯æ—¶ä½¿ç”¨å ä½å›¾ç‰‡
            event.target.src = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="500" height="400"%3E%3Crect fill="%23f0f0f0" width="500" height="400"/%3E%3Ctext fill="%23999" font-family="sans-serif" font-size="24" dy="200" dx="180"%3EçŒ«å’ªå›¾ç‰‡%3C/text%3E%3C/svg%3E';
        }

        // Add global error handler for images - ä¸ºå›¾ç‰‡æ·»åŠ å…¨å±€é”™è¯¯å¤„ç†
        document.addEventListener('error', (event) => {
            if (event.target.tagName === 'IMG') {
                handleImageError(event);
            }
        }, true);

        // Initialize when DOM is ready - DOMå‡†å¤‡å¥½ååˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initCatCards);
        } else {
            initCatCards();
        }
    </script>
</body>
</html>